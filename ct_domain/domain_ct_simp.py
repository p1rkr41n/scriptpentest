from crtsh import crtshAPI
import sys

def get_links(domain):
    lister = crtshAPI().search(domain)
    fixlist =[]
    lastlist = []
    for line in lister:
            fixlist.extend( line["common_name"])
            fixlist.extend(line["name_value"].split("\n"))
    fixlist = set(fixlist)
    fixlist = list(fixlist)
    fixlist = sorted(fixlist)

    for lining in fixlist:
        if domain in lining:
            if '*' in lining:
                continue
            elif "www" in lining:
                lining.lstrip("www.")
                # print(lining.replace("www.", ""))
                lastlist.append(lining)
            else:
                # print(lining)
                lastlist.append(lining.replace("www.", ""))
    # print(len(lastlist))
    if len(lastlist) == 1:
        return []
    else:
        # lastlist= set(lastlist)
        return lastlist



if __name__ == "__main__":
    # Deep scan all subdomain use https (certificate transparency reported)
    # get start
    try:
        domain = sys.argv[1]
    except :
        print("Scanning example.com...")
        domain = "example.com"
    domainlist = [domain]


    print("Processing domain: " + domain)
    domainlist= get_links(domain)
    for domain in domainlist:
        print(domain)
